# 初回実装 要求定義

## 概要

スワイプ操作と感情リアクションキャラクターを中心に据えたクイズアプリの初回MVP実装。
`docs/` の設計ドキュメントに基づき、全機能を実装する。

---

## 実装スコープ

### プレイヤー向け機能

#### 1. トップ画面（/）
- 保存済みクイズセットの一覧を表示する
- セットごとに「タイトル・問題数・スタートボタン」を表示する
- 管理画面へのリンクを表示する
- セットが0件の場合は「セットがまだありません」などの空状態を表示する

#### 2. クイズプレイ画面（/play/[setId]）
- 現在の問題番号 / 総問題数を表示する
- カードスタック（現在の問題 + 背後に次の問題のスタック表示）を表示する
- カードを左右にドラッグしてスワイプ操作で回答できる
  - 左スワイプ → 選択肢A
  - 右スワイプ → 選択肢B
  - 閾値（画面幅の30%）を超えたら回答確定
  - 閾値未満で離したらキャンセル
- ドラッグ量に応じてカードが傾く（±15°）
- ドラッグ中に左右の選択肢ラベルが強調される
- 選択肢ラベルのタップでも回答できる（スワイプのフォールバック）
- 回答確定後のフィードバック演出（正解 ✅ / 不正解 ❌ のオーバーレイ、約1.3秒）
- キャラクターが状態（`idle` / `thinking` / `correct` / `incorrect`）に応じて表情を変える
- 全問回答後にリザルト画面へ遷移する
- 「×終了」ボタンで途中終了確認ダイアログを表示し、確認後にトップへ戻る

#### 3. リザルト画面（/result/[setId]）
- 正解数・総問題数・正答率を表示する
- 正答率に応じてキャラクターの表情が変わる（`perfect` / `correct` / `idle` / `low_score`）
- 全問分の振り返り（問題文・自分の回答・正解・解説）を一覧表示する
- 「もう一度」ボタンでプレイ画面に戻る
- 「トップへ」ボタンでトップ画面に戻る

### 管理者向け機能

#### 4. 管理画面（/admin）
- クイズセットの一覧を表示する
- セット削除ボタン（確認ダイアログを表示し、確認後に削除する）
- セット編集ボタンでセット編集画面へ遷移する
- 「+ セット追加」ボタンでセット作成画面へ遷移する

#### 5. セット編集・作成画面（/admin/set/new, /admin/set/[id]/edit）
- セットのタイトル・説明を編集できる
- セットに属するクイズの一覧を表示する
- クイズの「編集」「削除」ができる
- 「+ クイズを追加」でモーダルが開き、クイズを追加できる
- 「保存する」で保存して管理画面に戻る

#### 6. クイズ入力モーダル
- 問題文・選択肢A・選択肢B・正解（A/B）・解説（任意）を入力できる
- バリデーション：問題文・選択肢A・選択肢B・正解は必須
- 「保存」で追加/更新、「キャンセル」で閉じる

---

## ユーザーストーリー

### プレイヤー

- クイズプレイヤーとして、セット一覧からプレイしたいセットを選んでスタートしたい
- クイズプレイヤーとして、カードを左右にスワイプして直感的に回答したい
- クイズプレイヤーとして、正解・不正解にキャラクターが反応するのを楽しみたい
- クイズプレイヤーとして、プレイ中は解説なしでテンポよく全問を解き切りたい
- クイズプレイヤーとして、全問終了後にスコアと解説をまとめて振り返りたい
- クイズプレイヤーとして、途中でやめたくなったらいつでもトップへ戻れるようにしたい

### 管理者

- クイズ作成者として、セットを作成してクイズをまとめて管理したい
- クイズ作成者として、既存クイズを編集・削除したい
- クイズ作成者として、初回起動時からサンプルクイズで動作確認できるようにしたい

---

## 受け入れ条件

### スワイプクイズプレイ
- [ ] カードを左右どちらかにドラッグすると、対応する選択肢ラベルが強調される
- [ ] ドラッグ量に応じてカードが傾く（最大±15°）
- [ ] 画面幅の30%以上スワイプして離すと回答が確定する
- [ ] 閾値未満で離すとカードが元の位置に戻る
- [ ] 回答確定後、カードが選択方向へ飛び去るアニメーションが再生される
- [ ] 次の問題カードが背後にスタック表示されている
- [ ] 全問回答後、リザルト画面へ遷移する

### 感情リアクション
- [ ] 待機中：`idle` 表情
- [ ] ドラッグ操作中：`thinking` 表情
- [ ] 正解確定後フィードバック中：`correct` 表情
- [ ] 不正解確定後フィードバック中：`incorrect` 表情

### リザルト画面
- [ ] 正解数・総問題数・正答率が表示される
- [ ] 正答率に応じたキャラクター表情が表示される
- [ ] 全問の振り返り（問題文・自分の回答・正解・解説）が表示される
- [ ] 「もう一度」「トップへ」ボタンが動作する

### 管理画面
- [ ] セット一覧が表示され、編集・削除・追加ができる
- [ ] セット編集画面でクイズの追加・編集・削除ができる
- [ ] 問題文・選択肢・正解が未入力の場合は保存できない

### データ・初期状態
- [ ] 初回起動時にサンプルデータ（1セット・5問以上）が自動投入される
- [ ] データはlocalStorageに保存され、リロード後も保持される

---

## 制約事項

- バックエンドは使用しない（localStorageのみ）
- 認証は実装しない（MVP段階）
- テストコードは今回のスコープ外
- 外部APIの呼び出しは行わない
